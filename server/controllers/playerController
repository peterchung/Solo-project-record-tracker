const fetch = require("node-fetch");

const playerController = {
  getPlayer: async (req, res, next) => {
    try {
      const profileName = req.body.name;
      const API_Key = "RGAPI-cafdb49c-0815-4df9-9bd5-3e4ffc24c5ba";
      const URL =
        "https://na1.api.riotgames.com/lol/summoner/v4/summoners/by-name/";

      // API fetch url with profile name
      let APICallString = URL + profileName + "?api_key=" + API_Key;

      let response = await fetch(APICallString);
      let playerData = await response.json();
      res.locals.profile = playerData;
      return next();
    } catch (err) {
      return next({
        log: "Express error handler caught error in playerController.getPlayer",
        status: 400,
        message: { err: "An error occurred" },
      });
    }
  },
};

module.exports = playerController;
